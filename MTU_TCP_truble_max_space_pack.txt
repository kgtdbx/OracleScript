Тонкая настройка TCP/IP в Windows (ускорение интернета).

MTU - Maximum Transmission Unit.
Это максимальный размер пакета данных, который может быть передан за один физический кадр по протоколу TCP/IP. Дело в том, что данные от компьютера к компьютеру в Интернете идут не сплошным потоком, а этими самыми кадрами - пакетами строго определенного размера.
При этом слишком большой пакет в пути, скорее всего, будет фрагментироваться и заполняться "воздухом", "балластом", что негативно скажется на эффективности связи. Так, если ваш провайдер имеет установки MTU=576, а у вас в Windows задано MTU=1500, то каждый ваш пакет будет им разбиваться на три по 576 байт: 576+576+576=1728 - то есть, 228 байт балласта будут добавляться к каждому вашему пакету. Но даже если провайдер тоже имеет MTU=1500, то при связи с удаленным сервером вполне может попасться маршрутизатор с меньшим значением MTU и пакеты опять-таки будут фрагментироваться, замедляя передачу данных.

MSS - Maximum Segment Size - это еще один параметр протокола TCP, определяющий самый большой сегмент данных TCP, которые могут быть переданы за один раз. То есть, MTU = MSS + заголовки TCP/IP. Для заголовка тоже имеется общепринятый размер - это 40 байт (20 байт IP и 20 байт TCP), следовательно, обычно MSS = MTU - 40. Этот параметр не устанавливается, а вычисляется:)

RWIN - Receive Window - окно приема, размер буфера, в котором накапливается содержимое области данных (MSS) нескольких полученных пакетов, прежде чем передается дальше, например, в браузер. При недостаточном размере этого буфера иногда происходит его переполнение, и поступающие пакеты отвергаются и теряются. Размер RWIN обязательно должен быть кратен MSS и обычно для лучшей эффективности модемного соединения рекомендуется его устанавливать равным 4 - 8 MSS. Однако, чрезмерно большой размер буфера также нежелателен, особенно на плохих линиях - при потере всего одного пакета в случае сбоя на линии будет повторно затребован не один потерянный пакет, а все пакеты из этого буфера, что займет некоторое время.

TTL - Time To Live - время жизни - количество хопов, то есть промежуточных серверов, через которые может пройти ваш пакет в поисках своего места назначения. Каждый такой сервер добавляет единицу к специальному счетчику в заголовке вашего пакета, и когда счетчик достигает максимально разрешенного значения, пакет считается заблудившимся и прекращает свое существование. По умолчанию TTL равен 32, что сегодня явно недостаточно для разросшегося Интернета - нередки случаи, когда удаленный сервер находится более чем в 32 переходах, поэтому TTL следует увеличить как минимум до 64.

-----------------------------------------------------
Таким образом, логично считать, что большие пакеты в итоге все-таки предпочтительнее, и если ваш провайдер настроил свои серверы и маршрутизаторы на большие пакеты, то надо стремиться использовать это на всю катушку.
Итак, надо определить MTU провайдера (оператора). Определяем вручную: Только сначала надо установить MTU равным 1500б. это можно сделать и вручную в реестре, но лучше (чтобы и остальные параметры также править) использовать спец. проги, например 
MTUspeed.
После этого мерием MTU прова.
В командной строке:
PING -f -l 1500 ххх.ххх.ххх.ххх, где "ххх.ххх.ххх.ххх" - IP-адрес тестируемого сервера, а "-I" - это буква L, а не единица. -l это размер буфера отправки(1500). -f это флаг запрещающий фрагментацию пакета.

Например, у меня получилось так:

PING -f -l 1472 mail.ru
Обмен пакетами с mail.ru [194.67.57.51] по 1472 байт:
Ответ от 194.67.57.51: число байт=1472 время=3617мс TTL=249
Ответ от 194.67.57.51: число байт=1472 время=3315мс TTL=249
Ответ от 194.67.57.51: число байт=1472 время=3271мс TTL=249

PING -f -l 1473 mail.ru
Обмен пакетами с mail.ru [194.67.57.51] по 1473 байт:
Требуется фрагментация пакета, но установлен запрещающий флаг.
Требуется фрагментация пакета, но установлен запрещающий флаг.
Требуется фрагментация пакета, но установлен запрещающий флаг.

Но это не значит, что MTU прова 1472б. Ping прибавляет к нашим данным заголовок - IP (20 Байтов) и ICMP (8 Байтов). Итак, MTU прова 1500б.

Несмотря на то, что программ, предназначенных якобы для двукратного улучшения связи одним кликом мыши - пруд пруди. И тут, как вы можете сами понять, совсем не факт, что MTU=576, которое везде рекомендуется западными программистами и экспертами, будет оптимальным и для нас в России. Наши провайдеры сплошь и рядом выбирают для себя MTU=1500, а при "пинговании" удаленных серверов мы обнаруживаем, что пакет такого размера, вопреки всем утверждениям, проходит чаще всего нефрагментированным.


Способ 3. Вручную установите значение MTU для сетевого интерфейса

Если вручную установить значение MTU для сетевого интерфейса, то это значение будет использоваться вместо значения по умолчанию. Размер MTU — это максимальный размер пакета (в байтах), который может быть передан транспортным протоколом по используемой сети. 

Применение данного метода влияет на все отправляемые пакеты и может значительно снизить производительность сети (в зависимости от указываемого размера MTU). 

Чтобы установить значение MTU для сетевого интерфейса, выполните следующие действия.
Выберите в меню Пуск пункт Выполнить, введите команду regedit и нажмите кнопку ОК.
Найдите и выделите следующий раздел реестра:
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\<ID for network interface>
В меню Правка выберите пункт Создать, а затем Параметр DWORD.
Введите MTU и нажмите клавишу ВВОД,
В меню Правка выберите команду Изменить.
В поле Значение укажите размер MTU и нажмите кнопку ОК.
Закройте редактор реестра и перезапустите компьютер.
----------------------------------
Правь реестр - это даст небольшое ускорение.
Максимальный размер передаваемого блока данных Maximum Transmission Unit Size 
Здесь нам предоставляется возможность задать наибольший размер передаваемого блока данных - Maximum Transmission Unit. MTU - это самое большое количество данных, которые могут быть переданы по сети в одном физическом фрейме. Если пакет IP большего чем MTU, то произойдет фрагментация. Эта фрагментация может удвоить время, которое требуется, чтобы послать единственный пакет.

Для изменения размера MTU следует добавить новый параметр и установить желаемое значение. По-умолчанию оно равно 1500 в десятичной системе или 0x5DC в шестнадцатеричной. Для модемных соединений рекомендовано значение 0x240. Однако это ещё не всё, смотрите параметр "Enable MTU Auto Discovery" описанный немного ниже.

HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
MTU =dword:576 

Максимальный размер окна для приёма пакетов Windows TCP/IP Window Size 
Этот параметр определяет максимальный размер окна для приёма TCP пакетов, предлагаемый операционной системой. Окно приёма определяет количество байтов, которые отправитель может передать, не получая подтверждения. Вообще, чем больше окно, тем лучше работа в сетях с высокой пропускной способностью. Однако, не всё так просто. Достаточно сказать, что для того, чтобы точно определить значение окна, необходимо будет добавить раздел и параметр в реестре. Значение по- умолчанию 0x2238, а для модемных соединений устанавливать и изменять его не рекомендуется. Коротко и ясно. 

HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
TCPWindowSize =dword:2238

Максимальное время Default Time to Live Setting 
TTL определяет максимальное время, которое пакет IP может прожить в сети, не достигая адресата. Поэтому использование этой опции определяет, как долго компьютер будет ждать, прежде чем решит, что запрашиваемый вебсайт не найден. 
Рекомендованное значение равно 128. Добавьте следующий ключ :

HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
DefaultTTL=dword:80 

Повторная передача данных Selective Acknowledgement Support 
Когда поддержка Selective Acknowledgement (SACK)включена, и пакет или ряд пакетов TCP потеряны, то получатель может сообщить отправителю точно, какие данные были получены, и где находится "дыра" в данных. Тогда отправитель может выборочно повторить передачу только недостающих данных, и не будет повторно передавать блоки данных, которые уже были успешно получены. Особенно это важно для больших TCP окон, см. описание следующей опции.
Для включения возможности SACK нужно добавить в реестр такой ключ :

HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
SackOpts =dword:1

служба QoS (Quality of Service)
По умолчанию служба QoS (Quality of Service) в Windows XP резервирует для своих нужд 20% от пропускной способности канала (любого, хоть модем на 14400, хоть гигабитный Ethernet). Причём, даже если удалить службу QoS Packet Scheduler в свойствах соединения, этот канал не освобождается. Освободить канал, или просто настроить QoS, можно так. Запускаем апплет Group Policy (http://gpedit.msc). В Group Policy находим "Localcomputer policy" и нажимаем на "Administrative template". Выбираем пункт "Network" – "QoS Packet Sheduler". Включаем "Limit reservable bandwidth". Теперь снижаем "Bandwidth limit" с 20% до 0. При желании здесь же можно настроить и другие параметры QoS. Далее отправляйтесь в сетевую конфигурацию (иконка Network Connections в Контрольной панели) . 
- Выделите свое соединение и из контекстного меню запустите Properties. 
- В закладке Networking убедитесь, что протокол QoS Packet Scheduler подключен (enabled). Если его нет, добавить из списка (через кнопку Добавить) .
- Перегрузите компьютер.