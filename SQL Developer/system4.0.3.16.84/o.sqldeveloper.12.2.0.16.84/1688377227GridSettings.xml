<?xml version = '1.0' encoding = 'UTF-8'?>
<TableSettings class="oracle.dbtools.raptor.controls.grid.RaptorGridPersistedSettings" xmlns="http://xmlns.oracle.com/jdeveloper/110000/Table-attributes">
   <columnPositions class="java.util.ArrayList">
      <Item class="java.lang.String">010_code</Item>
      <Item class="java.lang.String">020_group</Item>
      <Item class="java.lang.String">030_underlying_asset</Item>
      <Item class="java.lang.String">040_conn</Item>
      <Item class="java.lang.String">050_original_exposure</Item>
      <Item class="java.lang.String">060_defaulted</Item>
      <Item class="java.lang.String">070_debt_instruments</Item>
      <Item class="java.lang.String">080_equity</Item>
      <Item class="java.lang.String">090_derivatives</Item>
      <Item class="java.lang.String">100_loan_comm</Item>
      <Item class="java.lang.String">110_guarantee</Item>
      <Item class="java.lang.String">120_other</Item>
      <Item class="java.lang.String">130_ind_debt_instruments</Item>
      <Item class="java.lang.String">140_ind_equity</Item>
      <Item class="java.lang.String">150_ind_derivatives</Item>
      <Item class="java.lang.String">160_ind_loan_comm</Item>
      <Item class="java.lang.String">170_ind_guarantees</Item>
      <Item class="java.lang.String">180_ind_other</Item>
      <Item class="java.lang.String">190_add_exp</Item>
      <Item class="java.lang.String">200_value_adj</Item>
      <Item class="java.lang.String">210_own_funds</Item>
      <Item class="java.lang.String">220_exposure_value</Item>
      <Item class="java.lang.String">230_trading_book</Item>
      <Item class="java.lang.String">240_perc</Item>
      <Item class="java.lang.String">250_sub_debt_instruments</Item>
      <Item class="java.lang.String">260_sub_equity</Item>
      <Item class="java.lang.String">270_sub_derivatives</Item>
      <Item class="java.lang.String">280_sub_loan_comm</Item>
      <Item class="java.lang.String">290_sub_guarantees</Item>
      <Item class="java.lang.String">300_sub_other</Item>
      <Item class="java.lang.String">310_sub_other_fund</Item>
      <Item class="java.lang.String">320_real_est</Item>
      <Item class="java.lang.String">330_exempted</Item>
      <Item class="java.lang.String">340_total_after</Item>
      <Item class="java.lang.String">350_non_trading</Item>
      <Item class="java.lang.String">360_per_after</Item>
   </columnPositions>
   <columnWidths>
      <Item>75</Item>
      <Item>75</Item>
      <Item>125</Item>
      <Item>66</Item>
      <Item>128</Item>
      <Item>89</Item>
      <Item>127</Item>
      <Item>73</Item>
      <Item>96</Item>
      <Item>96</Item>
      <Item>93</Item>
      <Item>69</Item>
      <Item>147</Item>
      <Item>93</Item>
      <Item>116</Item>
      <Item>116</Item>
      <Item>118</Item>
      <Item>89</Item>
      <Item>85</Item>
      <Item>90</Item>
      <Item>96</Item>
      <Item>120</Item>
      <Item>106</Item>
      <Item>64</Item>
      <Item>150</Item>
      <Item>96</Item>
      <Item>119</Item>
      <Item>119</Item>
      <Item>121</Item>
      <Item>92</Item>
      <Item>120</Item>
      <Item>82</Item>
      <Item>96</Item>
      <Item>95</Item>
      <Item>101</Item>
      <Item>89</Item>
   </columnWidths>
   <searchParams class="java.util.ArrayList"/>
   <sortClauses>
      <Item/>
   </sortClauses>
   <uniqueName>IdeConnections%23VHGTEST_MIMIRwith stmt_xbrl_dates as  
(select to_date(capital_date, 'DD.MM.YYYY') as capital_date,  
        to_date(htv_date, 'DD.MM.YYYY')     as htv_date  
  from  xbrl_dates) 

,stmt_total_reg_cap as 
( 
select total_regulatory_capital from utgardur.capital_info ci 
where ci.the_date = (select capital_date from stmt_xbrl_dates) 
and ci.consolidate_parent = 'Móðurfélag' 
) 

, stmt_main as 
( 

select  
  htv.ssn                                                                           as "010_code", 
  nvl(htv.group_ssn,htv.ssn)                                                        as "020_group", 
  'No'                                                                              as "030_underlying_asset", 
  case  
    when company_control = 'X'  
      then 'Control' 
        when company_control = 'I'  
          then 'Interconnectedness' 
    else company_control  
  end                                                                               as "040_conn", 
  round(sum(nvl(obs_exposure,0) + nvl(exposure,0)),0)                               as "050_original_exposure", 
  round(sum(case     
              when is_in_arrears = 1 or specific_imp_allowance &lt; 0   
                then nvl(obs_exposure,0) + nvl(exposure,0)   
              else 0     
              end)   
        ,0)                                                                         as "060_defaulted", 
  round(sum(case     
              when nvl(product_type,0) not in ('H','D','Derivatives')    
                then exposure    
              else 0     
              end)   
        ,0)                                                                         as "070_debt_instruments", 
  round(sum(case     
              when nvl(product_type,0) in ('H','D')      
                then exposure    
            else 0   
            end)     
        ,0)                                                                         as "080_equity", 
  round(sum(case     
              when nvl(product_type,0) = 'Derivatives'   
                then exposure    
            else 0   
            end)     
        ,0)                                                                         as "090_derivatives", 
  round(sum(case     
              when nvl(product_type,0) = 'Undrawn credit line'   
                then obs_exposure    
              else 0     
            end)     
        ,0)                                                                         as "100_loan_comm", 
  round(sum(case     
              when nvl(product_type,0) = 'Guarantee'     
                then obs_exposure    
              else 0     
              end)   
        ,0)                                                                         as "110_guarantee", 
  round(sum(case     
              when nvl(product_type,0) not in ('Guarantee','Undrawn credit line')     
                then obs_exposure else 0 end),0)                                    as "120_other", 
  null                                                                              as "130_ind_debt_instruments", 
  null                                                                              as "140_ind_equity", 
  null                                                                              as "150_ind_derivatives", 
  null                                                                              as "160_ind_loan_comm", 
  null                                                                              as "170_ind_guarantees", 
  null                                                                              as "180_ind_other", 
  null                                                                              as "190_add_exp", 
  -round(sum(nvl(obs_exposure,0) + nvl(exposure,0)) - sum(credit_risk_exposure),0)  as "200_value_adj", 
  -null                                                                             as "210_own_funds", 
  round(sum(credit_risk_exposure),0)                                                as "220_exposure_value", 
  round(sum(case  
              when nvl(risk_classification,0) &lt;> 'Trading Book'  
                then credit_risk_exposure  
            else 0 end) 
        ,0)                                                                         as "230_trading_book", 

  round(sum(credit_risk_exposure)/(select total_regulatory_capital  
                                     from stmt_total_reg_cap) 
        ,4)                                                                         as "240_perc", 
  -null                                                                             as "250_sub_debt_instruments", 
  -null                                                                             as "260_sub_equity", 
  -null                                                                             as "270_sub_derivatives", 
  -null                                                                             as "280_sub_loan_comm", 
  -null                                                                             as "290_sub_guarantees", 
  -null                                                                             as "300_sub_other", 
  -null                                                                             as "310_sub_other_fund", 
  -null                                                                             as "320_real_est", 

  -round(sum(case  
               when htv.ssn in ('4712830459','6611983629','5602694129')  
                 then credit_risk_exposure  
               else 0  
               end) 
        ,0)                                                                         as "330_exempted", 
  round(sum(credit_risk_exposure - case  
                                     when htv.ssn in ('4712830459','6611983629','5602694129')  
                                        then credit_risk_exposure  
                                     else 0  
                                     end) 
        ,0)                                                                         as "340_total_after", 
  round(sum(case  
              when nvl(risk_classification,0) &lt;> 'Trading Book'  
                then credit_risk_exposure  
              else 0  
              end) - sum(case  
                           when htv.ssn in ('4712830459','6611983629','5602694129')  
                             then case  
                                    when nvl(risk_classification,0) &lt;> 'Trading Book'  
                                      then credit_risk_exposure  
                                    else 0  
                                  end  
                           else 0  
                         end) 
                        ,0)                                                         as "350_non_trading", 
  round((sum(credit_risk_exposure) - sum(case  
                                           when htv.ssn in ('4712830459','6611983629','5602694129')  
                                             then credit_risk_exposure  
                                           else 0  
                                         end) 
        )/(select total_regulatory_capital  
             from stmt_total_reg_cap) 
        ,4)                                                                         as "360_per_after" 
from mimir.v_crd_large_exposure_detail htv 
left join ( 

 
select ssn,max(contr) company_control from ( 
/*  select ssn_1 ssn,nvl(company_control,'I') contr from BIFROST.stg_sap_mdm_bp_rel 
  where (select htv_date from stmt_xbrl_dates)  between valid_from and valid_to 
  UNION ALL 
  select ssn_2 ssn,nvl(company_control,'I') contr from BIFROST.stg_sap_mdm_bp_rel 
  where (select htv_date from stmt_xbrl_dates)  between valid_from and valid_to */ 
  select '' as ssn, null as contr from dual where 0=1 
 ) group by ssn 
 ) con on htv.ssn = con.ssn 
inner join v_crd_large_exposure_p_c27 x on htv.ssn = x.code 
where htv.the_date = (select htv_date from stmt_xbrl_dates)  

and htv.group_ssn in (select code from v_crd_large_exposure_p_c27) 
group by htv.ssn,nvl(htv.group_ssn,htv.ssn),  case  
                                                when company_control = 'X'  
                                                    then 'Control' 
                                                when company_control = 'I'  
                                                    then 'Interconnectedness' 
                                                else company_control  
                                              end 
order by round(sum(credit_risk_exposure),0) desc 
) 
select * from stmt_main</uniqueName>
</TableSettings>
